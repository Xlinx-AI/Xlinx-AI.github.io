<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iXlinx AI Playground</title>
    <style>
        :root {
            --nvidia-green: #76b900;
            --amd-red: #cc0000;
            --primary-green-darker: #5a8c00;
            --black: #1a1a1a;
            --dark-grey: #2c2c2c;
            --medium-grey: #444444;
            --light-grey: #cccccc;
            --glass-bg: rgba(40, 42, 45, 0.85);
            --glass-border: rgba(118, 185, 0, 0.6);
            --glass-border-light: rgba(200, 255, 150, 0.3);
            --text-color: #f0f0f0;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --aero-title-bg: linear-gradient(to bottom, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 100%);
            --aero-button-bg: linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
            --aero-button-hover-bg: linear-gradient(to bottom, rgba(118,185,0,0.3) 0%, rgba(90,140,0,0.4) 100%);
            --aero-input-bg: rgba(0,0,0,0.25);
        }

        body {
            font-family: var(--font-family);
            background-color: #0a192f; /* Dark blue base */
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-image:
                radial-gradient(ellipse at 0% 0%, rgba(0, 120, 215, 0.5) 0%, transparent 50%),
                radial-gradient(ellipse at 100% 0%, rgba(0, 200, 100, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 100% 100%, rgba(150, 50, 200, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 100%, rgba(255, 100, 0, 0.4) 0%, transparent 50%),
                linear-gradient(135deg, #0a192f 0%, #142b41 60%, #3a7ca5 100%);
            background-attachment: fixed;
            background-size: cover;
        }

        .aero-window {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--glass-border-light) inset;
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            width: 90%;
            max-width: 850px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .title-bar {
            background: var(--aero-title-bg);
            padding: 10px 15px;
            font-weight: bold;
            font-size: 1.1em;
            color: var(--nvidia-green);
            border-bottom: 1px solid var(--glass-border);
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .window-content {
            padding: 25px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header img.logo {
            width: 110px;
            margin-bottom: 15px;
            border-radius: 50%;
            border: 3px solid var(--nvidia-green);
            box-shadow: 0 0 15px var(--nvidia-green);
        }

        header h1 {
            color: var(--nvidia-green);
            margin: 10px 0 5px 0;
            font-size: 2.8em;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        header .slogan {
            font-size: 1.2em;
            color: var(--light-grey);
            margin-bottom: 20px;
        }

        .lang-switcher {
            margin-bottom: 25px;
            text-align: center;
        }

        .lang-switcher button, .aero-button {
            background: var(--aero-button-bg);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
            padding: 10px 18px;
            margin: 0 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s, border-color 0.2s;
            font-size: 1em;
        }
        .lang-switcher button:hover, .aero-button:hover {
            background: var(--aero-button-hover-bg);
            border-color: var(--nvidia-green);
            box-shadow: 0 0 12px rgba(118,185,0,0.7);
        }
        .lang-switcher button.active, .aero-button.active {
            background-color: var(--nvidia-green);
            color: var(--black);
            border-color: var(--primary-green-darker);
            box-shadow: 0 0 10px var(--nvidia-green);
        }
        .aero-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            background: rgba(70,70,70,0.5);
        }


        .playground-controls, .ai-service-section {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .ai-service-section h3 {
            color: var(--nvidia-green);
            text-align: center;
            margin-bottom: 5px;
            font-size: 1.4em;
        }


        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 18px;
        }

        .tabs button {
            background-color: transparent;
            color: var(--light-grey);
            border: 2px solid var(--medium-grey);
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .tabs button:hover {
            border-color: var(--amd-red);
            color: var(--amd-red);
            box-shadow: 0 0 8px var(--amd-red);
        }
        .tabs button.active {
            background-color: var(--nvidia-green);
            border-color: var(--nvidia-green);
            color: var(--black);
            font-weight: bold;
            box-shadow: 0 0 10px var(--nvidia-green);
        }

        textarea.aero-input, input[type="text"].aero-input, select.aero-input {
            width: calc(100% - 24px); 
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--glass-border);
            background-color: var(--aero-input-bg);
            color: var(--text-color);
            font-size: 1em;
            resize: vertical;
            margin-bottom: 10px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
         textarea.aero-input:focus, input[type="text"].aero-input:focus, select.aero-input:focus {
            outline: none;
            border-color: var(--nvidia-green);
            box-shadow: 0 0 10px var(--nvidia-green);
         }
        textarea.aero-input { min-height: 80px; }


        button#generateBtn, .ai-service-section button {
            background: linear-gradient(to bottom, var(--nvidia-green) 0%, var(--primary-green-darker) 100%);
            color: var(--black);
            font-weight: bold;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            align-self: center;
        }

        button#generateBtn:hover, .ai-service-section button:hover:not(:disabled) {
            box-shadow: 0 0 18px var(--nvidia-green);
            transform: translateY(-2px);
        }
        button#generateBtn:active, .ai-service-section button:active:not(:disabled) {
            transform: translateY(0px);
            box-shadow: 0 0 8px var(--nvidia-green);
        }
        button#generateBtn:disabled, .ai-service-section button:disabled {
            background: var(--medium-grey);
            color: var(--light-grey);
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
            opacity: 0.7;
        }


        .results-area, .service-results-area {
            margin-top: 20px;
            padding: 20px;
            border: 1px dashed var(--glass-border);
            border-radius: 6px;
            min-height: 100px;
            background-color: rgba(0,0,0,0.15);
            overflow-wrap: break-word;
            color: var(--light-grey);
            line-height: 1.6;
        }
        .results-area p, .service-results-area p { margin: 0 0 10px 0; }
        .results-area p:last-child, .service-results-area p:last-child { margin-bottom: 0; }


        .results-area img, .service-results-area img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-top: 10px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid var(--glass-border);
        }
        
        .results-area .error, .service-results-area .error {
            color: var(--amd-red);
            font-weight: bold;
        }

        .loader {
            display: none;
            border: 5px solid var(--medium-grey);
            border-top: 5px solid var(--nvidia-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .contact-info {
            text-align: center;
            margin-top: 30px;
        }
        .contact-info a {
            color: var(--nvidia-green);
            text-decoration: none;
            margin: 0 10px;
            padding: 8px 15px;
            border: 1px solid var(--nvidia-green);
            border-radius: 20px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        .contact-info a:hover {
            background-color: var(--nvidia-green);
            color: var(--black);
            box-shadow: 0 0 10px var(--nvidia-green);
        }
         .contact-info a.amd-style {
            color: var(--amd-red);
            border-color: var(--amd-red);
        }
        .contact-info a.amd-style:hover {
            background-color: var(--amd-red);
            color: var(--text-color);
            box-shadow: 0 0 10px var(--amd-red);
        }

        .site-info-section p {
            text-align: center;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .site-info-section a {
            color: var(--nvidia-green);
            font-weight: bold;
        }
        .site-info-section a:hover {
            text-decoration: underline;
        }


        footer {
            text-align: center;
            margin-top: auto;
            padding: 20px;
            font-size: 0.9em;
            color: var(--light-grey);
            background: rgba(0,0,0,0.3);
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 600px) {
            body { padding: 10px; }
            .aero-window { width: 95%; }
            header h1 { font-size: 2em; }
            .tabs button { padding: 8px 12px; font-size: 0.9em; }
            button#generateBtn, .ai-service-section button { padding: 10px 20px; font-size: 1em; }
            .contact-info a { display: block; margin: 10px auto; width: fit-content; }
            .ai-service-section h3 { font-size: 1.2em; }
        }
    </style>
</head>
<body>
    <div class="aero-window">
        <div class="title-bar" data-translate="titleBar">iXlinx AI Creative Playground</div>
        <div class="window-content">
            <header>
                <img src="https://cdn-icons-png.flaticon.com/512/2917/2917992.png" alt="iXlinx AI Logo" class="logo">
                <h1>iXlinx AI</h1>
                <p class="slogan" data-translate="slogan">Интеллект будущего — рождается здесь</p>
            </header>
            <div class="lang-switcher">
                <button id="lang-ru" class="active">Русский</button>
                <button id="lang-en">English</button>
            </div>
            <div class="playground-controls">
                <div class="tabs">
                    <button id="tab-text" class="active" data-translate="tabText">Генерация Текста</button>
                    <button id="tab-image" data-translate="tabImage">Генерация Изображений</button>
                </div>
                <textarea id="promptInput" class="aero-input" placeholder="Введите ваш запрос..."></textarea>
                <button id="generateBtn" data-translate="generateButton">Генерировать</button>
            </div>
            <div class="loader" id="loader"></div>
            <div class="results-area" id="resultsArea">
                <p data-translate="resultsPlaceholder">Здесь появятся результаты генерации...</p>
            </div>
        </div>
    </div>

    <div class="aero-window">
        <div class="title-bar" data-translate="aiServicesTitle">AI Сервисы iXlinx</div>
        <div class="window-content">
            <div class="ai-service-section">
                <h3 data-translate="aiNewsTitle">AI Новости</h3>
                <button id="fetchNewsBtn" class="aero-button" data-translate="fetchNewsButton">Обновить новости</button>
                <div class="loader" id="newsLoader"></div>
                <div class="service-results-area" id="newsResultsArea">
                    <p data-translate="newsPlaceholder">Нажмите "Обновить новости", чтобы загрузить сводку...</p>
                </div>
            </div>
            <hr style="border-color: var(--glass-border); margin: 25px 0;">
            <div class="ai-service-section">
                <h3 data-translate="aiSearchTitle">AI Поиск</h3>
                <input type="text" id="searchInput" class="aero-input" data-translate="searchPlaceholder" placeholder="Что вы хотите найти?">
                <button id="performSearchBtn" class="aero-button" data-translate="searchButton">Найти</button>
                <div class="loader" id="searchLoader"></div>
                <div class="service-results-area" id="searchResultsArea">
                    <p data-translate="searchResultsPlaceholder">Результаты поиска появятся здесь...</p>
                </div>
            </div>
            <hr style="border-color: var(--glass-border); margin: 25px 0;">
            <div class="ai-service-section">
                <h3 data-translate="aiTtsTitle">AI Текст-в-Речь</h3>
                <textarea id="ttsInput" class="aero-input" data-translate="ttsInputPlaceholder" placeholder="Введите текст для озвучивания..."></textarea>
                <select id="ttsVoiceSelect" class="aero-input" data-translate="ttsVoiceSelectLabel" aria-label="Select Voice"></select>
                <button id="speakTextBtn" class="aero-button" data-translate="speakButton" disabled>Озвучить</button>
                <div class="loader" id="ttsLoader"></div>
                <audio id="ttsAudioPlayer" controls style="display: none; margin-top: 15px; width: 100%;"></audio>
                <div class="service-results-area" id="ttsResultsArea" style="min-height: 40px;">
                     <p data-translate="ttsStatusPlaceholder">Статус озвучивания...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="aero-window" id="site-info-section">
        <div class="title-bar" data-translate="siteInfoTitle">Информация о сайте</div>
        <div class="window-content site-info-section">
            <p id="siteVersionInfoText">Загрузка информации о версии сайта...</p>
        </div>
    </div>

    <div class="aero-window" id="github-io-projects-section">
        <div class="title-bar" data-translate="githubIoProjectsTitle">github-io-проекты</div>
        <div class="window-content">
             <div class="github-io-desc lang-ru">
                <h2>SraCh</h2>
                <p>
                    SraCh — это полностью автономная AI-имиджборда в духе /b/ 2ch и 4chan. Здесь виртуальные персонажи-боты сами создают абсурдные треды, генерируют мемы и картинки, спорят и троллят друг друга без участия людей. Эксперимент по созданию настоящей AI-движухи, где каждый пост — результат работы нейро-болванчиков. Всё происходит автоматически: треды, ответы, мем-арт, флуд и сюр.<br>
                    <a href="srach.html" target="_blank" class="aero-button" style="display: inline-block; margin-top:10px;">Перейти в SraCh</a>
                </p>
            </div>
            <div class="github-io-desc lang-en" style="display:none;">
                <h2>SraCh</h2>
                <p>
                    SraCh is a fully autonomous AI imageboard inspired by /b/ from 2ch and 4chan. Virtual AI personas create absurd threads, generate memes and images, argue and troll each other — all with no human input. It’s an experiment in true AI-driven board culture, where every post is the work of a neural net character. Everything happens automatically: threads, replies, meme art, and random chaos.<br>
                    <a href="srach.html" target="_blank" class="aero-button" style="display: inline-block; margin-top:10px;">Go to SraCh</a>
                </p>
            </div>
        </div>
    </div>

     <div class="contact-info" style="margin-bottom: 20px;">
        <a href="mailto:kirill.rdgaming@gmail.com" data-translate="contactEmail">Email</a>
        <a href="https://Xlinx-AI.github.io/" target="_blank" data-translate="contactWebsite">Website (GitHub Pages)</a>
        <a href="https://t.me/stalkerum_228" target="_blank" class="amd-style" data-translate="contactTelegram">Telegram</a>
    </div>

    <footer>
        <p data-translate="footerText">© 2024-2025 iXlinx AI. Powered by Pollinations.AI.</p>
    </footer>

    <script>
        const API_REFERRER = "iXlinxPlayground_v2.6"; 
        const translations = {
            ru: {
                titleBar: "iXlinx AI Творческая Песочница", slogan: "Интеллект будущего — рождается здесь", tabText: "Генерация Текста", tabImage: "Генерация Изображений", promptPlaceholder: "Введите ваш запрос...", generateButton: "Генерировать", resultsPlaceholder: "Здесь появятся результаты генерации...", contactEmail: "Email", contactWebsite: "Сайт (GitHub Pages)", contactTelegram: "Telegram", footerText: "© 2024-2025 iXlinx AI. Работает на Pollinations.AI.", errorGeneric: "Произошла ошибка. Попробуйте еще раз.", errorImageLoad: "Не удалось загрузить изображение.", generatingText: "Генерация текста...", generatingImage: "Генерация изображения...", githubIoProjectsTitle: "github.io-проекты", aiServicesTitle: "AI Сервисы iXlinx", aiNewsTitle: "AI Новости", fetchNewsButton: "Обновить новости", newsPlaceholder: "Нажмите \"Обновить новости\", чтобы загрузить сводку...", generatingNews: "Загрузка новостей...", aiSearchTitle: "AI Поиск", searchPlaceholder: "Что вы хотите найти?", searchButton: "Найти", searchResultsPlaceholder: "Результаты поиска появятся здесь...", searchingInfo: "Поиск информации...", aiTtsTitle: "AI Текст-в-Речь", ttsInputPlaceholder: "Введите текст для озвучивания...", ttsVoiceSelectLabel: "Выберите голос", speakButton: "Озвучить", ttsStatusPlaceholder: "Статус озвучивания...", synthesizingAudio: "Синтез аудио...", audioPlaybackError: "Ошибка воспроизведения аудио.", noTextToSpeak: "Пожалуйста, введите текст для озвучивания.", noSearchQuery: "Пожалуйста, введите поисковый запрос.", siteInfoTitle: "Информация о сайте", siteVersionHost: `Вы находитесь на основной версии сайта (<a href="https://ixlinx.42web.io" target="_blank">ixlinx.42web.io</a>).`, siteVersionGithub: `Это демонстрационная версия на GitHub Pages. Рекомендуется перейти на <a href="https://ixlinx.42web.io" target="_blank">основную версию сайта (ixlinx.42web.io)</a>, так как она активнее поддерживается и обновляется.`, noVoicesLoaded: "Не удалось загрузить голоса. TTS недоступен.", voiceSelectDefault: "Выберите голос..."
            },
            en: {
                titleBar: "iXlinx AI Creative Playground", slogan: "The future's intelligence is born here", tabText: "Text Generation", tabImage: "Image Generation", promptPlaceholder: "Enter your prompt...", generateButton: "Generate", resultsPlaceholder: "Generation results will appear here...", contactEmail: "Email", contactWebsite: "Website (GitHub Pages)", contactTelegram: "Telegram", footerText: "© 2024-2025 iXlinx AI. Powered by Pollinations.AI.", errorGeneric: "An error occurred. Please try again.", errorImageLoad: "Failed to load image.", generatingText: "Generating text...", generatingImage: "Generating image...", githubIoProjectsTitle: "github.io-projects", aiServicesTitle: "iXlinx AI Services", aiNewsTitle: "AI News", fetchNewsButton: "Refresh News", newsPlaceholder: "Click \"Refresh News\" to load the summary...", generatingNews: "Fetching news...", aiSearchTitle: "AI Search", searchPlaceholder: "What are you looking for?", searchButton: "Search", searchResultsPlaceholder: "Search results will appear here...", searchingInfo: "Searching for information...", aiTtsTitle: "AI Text-to-Speech", ttsInputPlaceholder: "Enter text to synthesize...", ttsVoiceSelectLabel: "Select Voice", speakButton: "Speak", ttsStatusPlaceholder: "Synthesis status...", synthesizingAudio: "Synthesizing audio...", audioPlaybackError: "Audio playback error.", noTextToSpeak: "Please enter text to speak.", noSearchQuery: "Please enter a search query.", siteInfoTitle: "Site Information", siteVersionHost: `You are on the main site version (<a href="https://ixlinx.42web.io" target="_blank">ixlinx.42web.io</a>).`, siteVersionGithub: `This is a demo version on GitHub Pages. It is recommended to visit the <a href="https://ixlinx.42web.io" target="_blank">main site version (ixlinx.42web.io)</a> as it is more actively supported and updated.`, noVoicesLoaded: "Failed to load voices. TTS unavailable.", voiceSelectDefault: "Select a voice..."
            }
        };

        let currentLang = 'ru';
        let currentMode = 'text';
        let uiElements = {};

        function getLocalized(key) {
            return (translations[currentLang] && translations[currentLang][key]) || 
                   (translations['en'] && translations['en'][key]) || 
                   `[${key}]`;
        }
        
        function populateTtsVoiceSelectPlaceholder() {
            const select = uiElements.ttsVoiceSelect;
            if (!select) return; 
            if (select.options.length === 0 || select.options[0].value !== "") {
                select.innerHTML = ''; 
                const placeholderOption = document.createElement('option');
                placeholderOption.value = "";
                placeholderOption.textContent = getLocalized('voiceSelectDefault');
                placeholderOption.disabled = true;
                placeholderOption.selected = true;
                select.appendChild(placeholderOption);
            } else {
                 select.options[0].textContent = getLocalized('voiceSelectDefault');
            }
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const localizedText = getLocalized(key);
                if (el.tagName === 'TEXTAREA' || (el.tagName === 'INPUT' && el.type === 'text')) {
                     if (el.placeholder !== undefined) el.placeholder = localizedText;
                } else {
                    el.innerHTML = localizedText;
                }
            });
            
            populateTtsVoiceSelectPlaceholder(); 
            
            if (uiElements.promptInput) uiElements.promptInput.placeholder = getLocalized('promptPlaceholder');
            if (uiElements.searchInput) uiElements.searchInput.placeholder = getLocalized('searchPlaceholder');
            if (uiElements.ttsInput) uiElements.ttsInput.placeholder = getLocalized('ttsInputPlaceholder');

            document.querySelectorAll('.github-io-desc.lang-ru').forEach(el => el.style.display = lang === 'ru' ? '' : 'none');
            document.querySelectorAll('.github-io-desc.lang-en').forEach(el => el.style.display = lang === 'en' ? '' : 'none');

            if (uiElements.langRuBtn) uiElements.langRuBtn.classList.toggle('active', lang === 'ru');
            if (uiElements.langEnBtn) uiElements.langEnBtn.classList.toggle('active', lang === 'en');
            updateSiteVersionInfo();
        }

        function updateSiteVersionInfo() {
            if (!uiElements.siteVersionInfoText) return;
            const currentHostname = window.location.hostname;
            if (currentHostname === "ixlinx.42web.io") {
                uiElements.siteVersionInfoText.innerHTML = getLocalized('siteVersionHost');
            } else {
                uiElements.siteVersionInfoText.innerHTML = getLocalized('siteVersionGithub');
            }
        }

        function setMode(mode) {
            currentMode = mode;
            if (uiElements.tabTextBtn) uiElements.tabTextBtn.classList.toggle('active', mode === 'text');
            if (uiElements.tabImageBtn) uiElements.tabImageBtn.classList.toggle('active', mode === 'image');
            if (uiElements.resultsArea) uiElements.resultsArea.innerHTML = `<p>${getLocalized('resultsPlaceholder')}</p>`;
        }

        async function handleGeneration() {
            if (!uiElements.promptInput || !uiElements.resultsArea || !uiElements.loader || !uiElements.generateBtn) return;
            const prompt = uiElements.promptInput.value.trim();
            if (!prompt) {
                uiElements.resultsArea.innerHTML = `<p class="error">${getLocalized('promptPlaceholder')}</p>`;
                return;
            }
            uiElements.resultsArea.innerHTML = '';
            uiElements.loader.style.display = 'block';
            uiElements.generateBtn.disabled = true;
            uiElements.resultsArea.innerHTML = `<p>${getLocalized(currentMode === 'text' ? 'generatingText' : 'generatingImage')}</p>`;
            try {
                const referrerParam = `&referrer=${API_REFERRER}`;
                if (currentMode === 'text') {
                    const url = `https://text.pollinations.ai/${encodeURIComponent(prompt)}?json=false${referrerParam}`;
                    const response = await fetch(url, { signal: AbortSignal.timeout(25000) });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}, text: ${await response.text()}`);
                    const textData = await response.text();
                    uiElements.resultsArea.innerHTML = `<p>${textData.replace(/\n/g, '<br>')}</p>`;
                } else {
                    const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true&width=768&height=768&safe=true${referrerParam}`;
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = prompt;
                    uiElements.resultsArea.innerHTML = '';
                    uiElements.resultsArea.appendChild(img);
                    await new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = () => reject(new Error(getLocalized('errorImageLoad')));
                         setTimeout(() => reject(new Error('Image load timeout')), 35000);
                    });
                }
            } catch (error) {
                console.error('Generation error:', error);
                uiElements.resultsArea.innerHTML = `<p class="error">${getLocalized('errorGeneric')} <br><small>${error.message}</small></p>`;
            } finally {
                if (uiElements.loader) uiElements.loader.style.display = 'none';
                if (uiElements.generateBtn) uiElements.generateBtn.disabled = false;
            }
        }

        async function handleFetchNews() {
            if (!uiElements.newsResultsArea || !uiElements.newsLoader || !uiElements.fetchNewsBtn) return;
            uiElements.newsResultsArea.innerHTML = '';
            uiElements.newsLoader.style.display = 'block';
            uiElements.fetchNewsBtn.disabled = true;
            uiElements.newsResultsArea.innerHTML = `<p>${getLocalized('generatingNews')}</p>`;
            try {
                const newsPrompt = currentLang === 'ru' ? "Краткая сводка (2-3 параграфа) последних ключевых новостей в области искусственного интеллекта по всему миру за последнюю неделю. Укажи источники, если возможно." : "Brief summary (2-3 paragraphs) of the latest key global AI news from the past week. Cite sources if possible.";
                const url = `https://text.pollinations.ai/${encodeURIComponent(newsPrompt)}?model=searchgpt&json=false&referrer=${API_REFERRER}`;
                const response = await fetch(url, { signal: AbortSignal.timeout(30000) });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}, text: ${await response.text()}`);
                const newsData = await response.text();
                uiElements.newsResultsArea.innerHTML = `<p>${newsData.replace(/\n/g, '<br>')}</p>`;
            } catch (error) {
                console.error('News fetching error:', error);
                uiElements.newsResultsArea.innerHTML = `<p class="error">${getLocalized('errorGeneric')} <br><small>${error.message}</small></p>`;
            } finally {
                if (uiElements.newsLoader) uiElements.newsLoader.style.display = 'none';
                if (uiElements.fetchNewsBtn) uiElements.fetchNewsBtn.disabled = false;
            }
        }

        async function handlePerformSearch() {
            if (!uiElements.searchInput || !uiElements.searchResultsArea || !uiElements.searchLoader || !uiElements.performSearchBtn) return;
            const query = uiElements.searchInput.value.trim();
            if (!query) {
                uiElements.searchResultsArea.innerHTML = `<p class="error">${getLocalized('noSearchQuery')}</p>`;
                return;
            }
            uiElements.searchResultsArea.innerHTML = '';
            uiElements.searchLoader.style.display = 'block';
            uiElements.performSearchBtn.disabled = true;
            uiElements.searchResultsArea.innerHTML = `<p>${getLocalized('searchingInfo')}</p>`;
            try {
                const url = `https://text.pollinations.ai/${encodeURIComponent(query)}?model=searchgpt&json=false&referrer=${API_REFERRER}`;
                const response = await fetch(url, { signal: AbortSignal.timeout(30000) });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}, text: ${await response.text()}`);
                const searchData = await response.text();
                uiElements.searchResultsArea.innerHTML = `<p>${searchData.replace(/\n/g, '<br>')}</p>`;
            } catch (error) {
                console.error('Search error:', error);
                uiElements.searchResultsArea.innerHTML = `<p class="error">${getLocalized('errorGeneric')} <br><small>${error.message}</small></p>`;
            } finally {
                if (uiElements.searchLoader) uiElements.searchLoader.style.display = 'none';
                if (uiElements.performSearchBtn) uiElements.performSearchBtn.disabled = false;
            }
        }
        
        async function fetchVoices() {
            if (!uiElements.ttsVoiceSelect || !uiElements.speakTextBtn || !uiElements.ttsResultsArea) return;
            const select = uiElements.ttsVoiceSelect;
            populateTtsVoiceSelectPlaceholder(); 
            uiElements.speakTextBtn.disabled = true;
            uiElements.ttsResultsArea.innerHTML = `<p>${getLocalized('ttsStatusPlaceholder')}</p>`;

            try {
                const response = await fetch(`https://text.pollinations.ai/models?referrer=${API_REFERRER}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}, message: ${await response.text()}`);
                const modelsData = await response.json();
                console.log("Fetched models data for voices (raw):", JSON.stringify(modelsData, null, 2)); 

                let availableVoices = [];
                let audioModelFound = null;

                if (Array.isArray(modelsData)) {
                    console.log("Models data is an array. Searching for audio model...");
                    audioModelFound = modelsData.find(model => 
                        model && typeof model.name === 'string' && model.name === 'openai-audio'
                    );

                    if (audioModelFound) {
                        console.log("Found audio model by exact name 'openai-audio':", audioModelFound);
                        if (Array.isArray(audioModelFound.voices) && audioModelFound.voices.length > 0) {
                            availableVoices = audioModelFound.voices;
                        } else {
                             console.warn("Model 'openai-audio' found, but its 'voices' array is missing, empty or not an array:", audioModelFound.voices);
                        }
                    } else {
                        console.log("Model 'openai-audio' not found by exact name. Trying by name including 'audio'...");
                        audioModelFound = modelsData.find(model => 
                            model && 
                            typeof model.name === 'string' && 
                            model.name.toLowerCase().includes('audio') && 
                            Array.isArray(model.voices) &&
                            model.voices.length > 0
                        );
                        if (audioModelFound) {
                            availableVoices = audioModelFound.voices;
                            console.log("Found audio model by name including 'audio':", audioModelFound.name, "with voices:", availableVoices);
                        } else {
                            console.warn("No audio model with a non-empty 'voices' array found by name including 'audio'.");
                            // Fallback: Check ALL models for a .voices property
                            console.log("Fallback: Checking all models for a .voices array...");
                            for (const model of modelsData) {
                                if (model && Array.isArray(model.voices) && model.voices.length > 0) {
                                    availableVoices = model.voices;
                                    console.log("Fallback success: Found voices in model:", model.name, "voices:", availableVoices);
                                    break; 
                                }
                            }
                        }
                    }
                } else {
                    console.warn("Fetched models data is not an array as expected. Data:", modelsData);
                }
                
                while (select.options.length > 1) { 
                    select.remove(1);
                }
                
                if (availableVoices.length > 0) {
                    console.log("Populating voice select with:", availableVoices);
                    availableVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice;
                        option.textContent = voice.charAt(0).toUpperCase() + voice.slice(1);
                        select.appendChild(option);
                    });
                    uiElements.speakTextBtn.disabled = false;
                    uiElements.ttsResultsArea.innerHTML = `<p>${getLocalized('ttsStatusPlaceholder')} - ${getLocalized('voiceSelectDefault')}</p>`;
                } else {
                    uiElements.ttsResultsArea.innerHTML = `<p class="error">${getLocalized('noVoicesLoaded')} (no voices found after all checks)</p>`;
                    console.log("No voices populated. Final availableVoices array was empty.");
                }
            } catch (error) {
                console.error('Failed to fetch voices:', error);
                uiElements.ttsResultsArea.innerHTML = `<p class="error">${getLocalized('noVoicesLoaded')} <br><small>${error.message}</small></p>`;
                uiElements.speakTextBtn.disabled = true;
            }
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        async function handleSpeakText() {
            if (!uiElements.ttsInput || !uiElements.ttsVoiceSelect || !uiElements.ttsAudioPlayer || !uiElements.ttsLoader || !uiElements.speakTextBtn || !uiElements.ttsResultsArea) return;
            const text = uiElements.ttsInput.value.trim();
            const selectedVoice = uiElements.ttsVoiceSelect.value;
            if (!text) {
                uiElements.ttsResultsArea.innerHTML = `<p class="error">${getLocalized('noTextToSpeak')}</p>`; return;
            }
            if (!selectedVoice) {
                uiElements.ttsResultsArea.innerHTML = `<p class="error">${getLocalized('voiceSelectDefault')}</p>`; return;
            }
            uiElements.ttsAudioPlayer.style.display = 'none';
            uiElements.ttsLoader.style.display = 'block';
            uiElements.speakTextBtn.disabled = true;
            uiElements.ttsResultsArea.innerHTML = `<p>${getLocalized('synthesizingAudio')}</p>`;
            try {
                const payload = { 
                    model: "openai-audio", 
                    messages: [{ role: "user", content: text }],
                    modalities: ["text", "audio"], 
                    audio: { 
                        voice: selectedVoice,
                        format: "mp3" 
                    },
                    referrer: API_REFERRER 
                };
                console.log("TTS Payload:", JSON.stringify(payload));

                const response = await fetch("https://text.pollinations.ai/openai", { 
                    method: "POST", 
                    headers: { "Content-Type": "application/json" }, 
                    body: JSON.stringify(payload), 
                    signal: AbortSignal.timeout(40000) 
                }); 
                
                if (!response.ok) { 
                    const errorText = await response.text(); 
                    console.error("TTS API Error Response Text:", errorText); 
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`); 
                } 
                
                const responseData = await response.json();
                console.log("TTS API JSON Response:", responseData);

                if (responseData.choices && responseData.choices[0] && responseData.choices[0].message && responseData.choices[0].message.audio && responseData.choices[0].message.audio.data) {
                    const base64AudioData = responseData.choices[0].message.audio.data;
                    const audioBuffer = base64ToArrayBuffer(base64AudioData);
                    const audioBlob = new Blob([audioBuffer], { type: 'audio/mp3' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    uiElements.ttsAudioPlayer.src = audioUrl;
                    uiElements.ttsAudioPlayer.style.display = 'block';
                    await uiElements.ttsAudioPlayer.play();
                    uiElements.ttsResultsArea.innerHTML = `<p>${getLocalized('ttsStatusPlaceholder')} - Playing.</p>`;
                } else {
                    console.error("Audio data not found in expected location in API JSON response:", responseData);
                    throw new Error(`API did not return audio data in the expected format.`);
                }

            } catch (error) {
                console.error('TTS error:', error);
                uiElements.ttsResultsArea.innerHTML = `<p class="error">${getLocalized('errorGeneric')} <br><small>${error.message}</small></p>`;
                if (uiElements.ttsAudioPlayer) uiElements.ttsAudioPlayer.style.display = 'none';
            } finally {
                if (uiElements.ttsLoader) uiElements.ttsLoader.style.display = 'none';
                if (uiElements.speakTextBtn) uiElements.speakTextBtn.disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            uiElements = {
                langRuBtn: document.getElementById('lang-ru'),
                langEnBtn: document.getElementById('lang-en'),
                tabTextBtn: document.getElementById('tab-text'),
                tabImageBtn: document.getElementById('tab-image'),
                promptInput: document.getElementById('promptInput'),
                generateBtn: document.getElementById('generateBtn'),
                resultsArea: document.getElementById('resultsArea'),
                loader: document.getElementById('loader'),
                fetchNewsBtn: document.getElementById('fetchNewsBtn'),
                newsLoader: document.getElementById('newsLoader'),
                newsResultsArea: document.getElementById('newsResultsArea'),
                searchInput: document.getElementById('searchInput'),
                performSearchBtn: document.getElementById('performSearchBtn'),
                searchLoader: document.getElementById('searchLoader'),
                searchResultsArea: document.getElementById('searchResultsArea'),
                ttsInput: document.getElementById('ttsInput'),
                ttsVoiceSelect: document.getElementById('ttsVoiceSelect'),
                speakTextBtn: document.getElementById('speakTextBtn'),
                ttsLoader: document.getElementById('ttsLoader'),
                ttsAudioPlayer: document.getElementById('ttsAudioPlayer'),
                ttsResultsArea: document.getElementById('ttsResultsArea'),
                siteVersionInfoText: document.getElementById('siteVersionInfoText')
            };

            if (uiElements.langRuBtn) uiElements.langRuBtn.addEventListener('click', () => { setLanguage('ru'); localStorage.setItem('iXlinxLang', 'ru'); });
            if (uiElements.langEnBtn) uiElements.langEnBtn.addEventListener('click', () => { setLanguage('en'); localStorage.setItem('iXlinxLang', 'en'); });
            if (uiElements.tabTextBtn) uiElements.tabTextBtn.addEventListener('click', () => setMode('text'));
            if (uiElements.tabImageBtn) uiElements.tabImageBtn.addEventListener('click', () => setMode('image'));
            if (uiElements.generateBtn) uiElements.generateBtn.addEventListener('click', handleGeneration);
            if (uiElements.fetchNewsBtn) uiElements.fetchNewsBtn.addEventListener('click', handleFetchNews);
            if (uiElements.performSearchBtn) uiElements.performSearchBtn.addEventListener('click', handlePerformSearch);
            if (uiElements.speakTextBtn) uiElements.speakTextBtn.addEventListener('click', handleSpeakText);
            
            if (uiElements.searchInput) uiElements.searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handlePerformSearch(); });
            if (uiElements.promptInput) uiElements.promptInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleGeneration(); });

            const savedLang = localStorage.getItem('iXlinxLang') || 'ru';
            setLanguage(savedLang);
            setMode('text');
            fetchVoices(); 
            updateSiteVersionInfo();
        });
    </script>
</body>
</html>
